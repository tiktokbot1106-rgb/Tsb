-- üå± Lunara Hub - AutoFarm + AutoSell otimizado
local player = game.Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local hrp = character:WaitForChild("HumanoidRootPart")
local playerGui = player:WaitForChild("PlayerGui")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local GameEvents = ReplicatedStorage:WaitForChild("GameEvents")

-- ‚öôÔ∏è Configura√ß√µes
local sellThreshold = 100
local autoFarmEnabled = false
local autoSellEnabled = false

-- üîç Achar fazenda
local function findOwnedFarm()
	local farms = workspace:FindFirstChild("Farm")
	if not farms then return nil end
	for _, farm in ipairs(farms:GetChildren()) do
		local important = farm:FindFirstChild("Important")
		if important then
			local data = important:FindFirstChild("Data")
			if data and data:FindFirstChild("Owner") and data.Owner.Value == player.Name then
				return farm
			end
		end
	end
end
local myFarm = findOwnedFarm()

-- üì¶ Contar frutas
local function countFruits()
	local total = 0
	for _, t in ipairs(player.Backpack:GetChildren()) do
		if t:IsA("Tool") then total += 1 end
	end
	for _, t in ipairs(player.Character:GetChildren()) do
		if t:IsA("Tool") then total += 1 end
	end
	return total
end

-- üìç Teleporte r√°pido
local function tp(obj)
	local part = obj:IsA("BasePart") and obj or obj.PrimaryPart or obj:FindFirstChildWhichIsA("BasePart")
	if part then
		character:PivotTo(part.CFrame + Vector3.new(0,3,0))
	end
end

-- ‚å®Ô∏è Pressionar E
local function pressE()
	local vim = game:GetService("VirtualInputManager")
	vim:SendKeyEvent(true, Enum.KeyCode.E, false, game)
	vim:SendKeyEvent(false, Enum.KeyCode.E, false, game)
end

-- üí∞ Vender
local function sellInventory()
	local tpFolder = workspace:FindFirstChild("Tutorial_Points")
	if tpFolder then
		local sellPoint = tpFolder:FindFirstChild("Tutorial_Point_2")
		if sellPoint then
			character:PivotTo(sellPoint.CFrame + Vector3.new(0,3,0))
		end
	end
	for i = 1, 10 do
		GameEvents.Sell_Inventory:FireServer()
	end
end

-- üå± Loop AutoFarm (com intervalo leve)
task.spawn(function()
	while true do
		if autoFarmEnabled and myFarm then
			local plants = myFarm.Important.Plants_Physical
			for _, plant in ipairs(plants:GetChildren()) do
				if not autoFarmEnabled then break end
				if countFruits() >= sellThreshold then break end

				local fruits = plant:FindFirstChild("Fruits")
				if fruits then
					for _, fruit in ipairs(fruits:GetChildren()) do
						if not autoFarmEnabled or countFruits() >= sellThreshold then break end
						tp(fruit)
						pressE()
						task.wait(0.05) -- üîπ pequeno intervalo (evita lag)
					end
				else
					tp(plant)
					pressE()
					task.wait(0.05)
				end
			end
		end
		task.wait(0.1)
	end
end)

-- üõí Loop AutoSell
task.spawn(function()
	while true do
		if autoSellEnabled and countFruits() >= sellThreshold then
			sellInventory()
		end
		task.wait(0.2)
	end
end)

-- üéõÔ∏è GUI
local gui = Instance.new("ScreenGui", playerGui)
local frame = Instance.new("Frame", gui)
frame.Size = UDim2.new(0,250,0,150)
frame.Position = UDim2.new(0.5,-125,0.5,-75)
frame.BackgroundColor3 = Color3.fromRGB(30,30,30)
frame.Active = true
frame.Draggable = true

local title = Instance.new("TextLabel", frame)
title.Size = UDim2.new(1,0,0,30)
title.Text = "Bitzhub - Grow a gardenüå±"
title.TextColor3 = Color3.new(1,1,1)
title.BackgroundColor3 = Color3.fromRGB(50,0,0)

-- Bot√£o Farm
local farmBtn = Instance.new("TextButton", frame)
farmBtn.Size = UDim2.new(1,-20,0,40)
farmBtn.Position = UDim2.new(0,10,0,40)
farmBtn.Text = "AutoFarm OFF"
farmBtn.MouseButton1Click:Connect(function()
	autoFarmEnabled = not autoFarmEnabled
	farmBtn.Text = autoFarmEnabled and "AutoFarm ON" or "AutoFarm OFF"
end)

-- Bot√£o Sell
local sellBtn = Instance.new("TextButton", frame)
sellBtn.Size = UDim2.new(1,-20,0,40)
sellBtn.Position = UDim2.new(0,10,0,90)
sellBtn.Text = "AutoSell OFF"
sellBtn.MouseButton1Click:Connect(function()
	autoSellEnabled = not autoSellEnabled
	sellBtn.Text = autoSellEnabled and "AutoSell ON" or "AutoSell OFF"
end)
